{% load i18n %}
{% load basefilters %}
{% include 'filter_tags.html' %}
<div class="oh-layout--grid-3">
  {% for device in devices %}
  <div
    class="oh-kanban-card oh-kanban-card--biometric {% if device.is_live %} oh-kanban-card--orange {% elif device.is_scheduler %} oh-kanban-card--blue {% else %} oh-kanban-card--red {% endif %}">
    <div class="oh-kanban-card__details">
      <span class="oh-kanban-card__title">{{device.name}}</span>
      <span class="oh-kanban-card__subtitle d-block"
        >{{device.machine_ip}}</span
      >
      <span class="oh-kanban-card__subtitle d-block">{{device.port}}</span>
      
        <table>
          <tr>
            <td><span class="oh-kanban-card__subtitle d-block">{% trans "Activate live capture mode" %}</td>
            <td>
              <div class="oh-switch">
                <input type="checkbox" class="style-widget oh-switch__checkbox is-live-activate" {% if device.is_live %} checked title="{% trans 'Deactivate' %}" {% else %}title="{% trans 'Activate' %}" {% endif %} id="isLiveActivate" data-id="{{device.id}}"> 
              </div>
            </td>
          </tr>
        </table>
      </span>
    </div>
    <div class="oh-kanban-card__dots">
      <div class="oh-dropdown" x-data="{show: false}">
        <button
          class="oh-btn oh-btn--transparent text-muted p-3"
          @click="show = !show">
          <ion-icon name="ellipsis-vertical-sharp"></ion-icon>
        </button>
        <div
          class="oh-dropdown__menu oh-dropdown__menu--dark-border oh-dropdown__menu--right"
          x-show="show"
          @click.outside="show = false">
          <ul class="oh-dropdown__items">
            <li class="oh-dropdown__item">
              <a href="{% url 'biometric-device-employees' device.id %}"
                 class="oh-dropdown__link">{% trans "Employees" %}
              </a>
            </li>
            <li class="oh-dropdown__item">
              <a 
                hx-get="{% url 'biometric-device-edit' device.id %}"
                class="oh-dropdown__link"
                data-toggle="oh-modal-toggle"
                data-target="#BiometricDeviceModal"
                hx-target="#BiometricDeviceFormTarget"
                >{% trans "Edit" %}</a
              >
            </li>
            {% if perms.attendance.change_biometricdevices %}
              {% if device.is_active  %}
              <li class="oh-dropdown__item">
                <a href="{% url 'biometric-device-archive' device.id %}" onclick="return confirm('{% trans "Do you want to archive this device?" %}')" class="oh-dropdown__link">{% trans "Archive" %}</a>
              </li>
              {% else %}
              <li class="oh-dropdown__item">
                <a href="{% url 'biometric-device-archive' device.id %}" onclick="return confirm('{% trans "Do you want to un-archive this device?" %}')" class="oh-dropdown__link">{% trans "Un-Archive" %}</a>
              </li>
              {% endif %}
            {% endif %}
            {% if perms.attendance.delete_biometricdevices %}
            <li class="oh-dropdown__item">
              <form action="{% url 'biometric-device-delete' device.id %}" onsubmit="return confirm('{% trans "Do you want to delete this device?" %}')" method="post">
                {% csrf_token %}
                <button  class="oh-dropdown__link oh-dropdown__link--danger  ">{% trans "Delete" %}</button>
              </form> 
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>
    <div class="d-block oh-kanban-card__biometric-actions">
      <a href="#" hx-get="{% url 'biometric-device-test' device.id %}"
          data-toggle="oh-modal-toggle" data-target="#BiometricDeviceTestModal"
          hx-target="#BiometricDeviceTestFormTarget"class="oh-checkpoint-badge text-success">{% trans "Test" %}</a>
        <a href="#" class="oh-checkpoint-badge text-info"
          hx-get="{% url 'biometric-device-schedule' device.id %}"
          data-toggle="oh-modal-toggle" data-target="#BiometricDeviceModal"
          hx-target="#BiometricDeviceFormTarget"
        >{% trans "Schedule" %}</a
      >
      <a href="{% url 'biometric-device-employees' device.id %}" class="oh-checkpoint-badge text-secondary bio-user-list" >{% trans "Employee" %}</a>
    </div>
  </div>
  {% endfor %}
</div>




<div class="oh-pagination">
  <span
    class="oh-pagination__page"
    data-toggle="modal"
    >
    {% trans "Page" %} {{ devices.number }} {% trans "of" %} {{ devices.paginator.num_pages }}.
    </span
  >
  <nav class="oh-pagination__nav">
    <div class="oh-pagination__input-container me-3">
      <span class="oh-pagination__label me-1">{% trans "Page" %}</span>

      <input
        type="number"
        name="page"
        class="oh-pagination__input"
        value="{{devices.number}}"
        hx-get="{% url 'search-devices' %}?{{pd}}&view=card"
        hx-target="#section"
        min="1"
      />
      <span class="oh-pagination__label">{% trans "of" %} {{devices.paginator.num_pages}}</span>
    </div>

    <ul class="oh-pagination__items">
      {% if devices.has_previous %}
      <li class="oh-pagination__item oh-pagination__item--wide">
        <a hx-target='#section' hx-get="{% url 'search-devices' %}?{{pd}}&page=1&view=card" class="oh-pagination__link">{% trans "First" %}</a>
      </li>
      <li class="oh-pagination__item oh-pagination__item--wide">
        <a hx-target='#section' hx-get="{% url 'search-devices' %}?{{pd}}&page={{ devices.previous_page_number }}&view=card" class="oh-pagination__link">{% trans "Previous" %}</a>
      </li>
      {% endif %}
      {% if devices.has_next %}
      <li class="oh-pagination__item oh-pagination__item--wide">
        <a hx-target='#section' hx-get="{% url 'search-devices' %}?{{pd}}&page={{ devices.next_page_number }}&view=card" class="oh-pagination__link">{% trans "Next" %}</a>
      </li>
      <li class="oh-pagination__item oh-pagination__item--wide">
        <a hx-target='#section' hx-get="{% url 'search-devices' %}?{{pd}}&page={{ devices.paginator.num_pages }}&view=card" class="oh-pagination__link">{% trans "Last" %}</a>
      </li>
      {% endif %}

    </ul>
  </nav>
</div>

<script>
  $(document).ready(function () {
    $(".bio-user-list").click(function(){
      $("#BiometricDeviceTestModal").toggleClass("oh-modal--show")
    });
    $(".is-live-activate").on('change',function() {
      var boolean = $(this).is(":checked")
      var deviceId = $(this).attr("data-id")
      $("#BiometricDeviceTestModal").toggleClass("oh-modal--show")

          $.ajax({
            type: "GET",
            url: "/attendance/biometric-device-live-capture",
            data: {
              is_live: boolean,
              deviceId: deviceId,
            },
            success: function (response, textStatus, jqXHR) {
              if (jqXHR.status === 200) {
                $("body").append(response.script)
              } else {
              }
            },
          });
    });
  });
</script>
